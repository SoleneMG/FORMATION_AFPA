function g_se(){$.post("http://www.buvetteetudiants.com/chat/g_se.php")}function r_ap(){$.post("http://www.buvetteetudiants.com/chat/r_ap.php")}function toggleTitle(e){nb_green_links=0;$("#constant_connected_users a").each(function(e){if($(this).css("color")=="rgb(0, 128, 0)")nb_green_links++});if(nb_green_links>0){if($("title").text()==e)$("title").text("Nouveaux messages !!!");else $("title").text(e)}if(nb_green_links==0){$("title").text(e)}}function nudge(e){$("#constant_connected_users a").css({color:" rgb(0, 51, 153)","font-weight":"400"});for(i=0;i<e.length;i++){jsFunctionStart='javascript:select_user("'+e[i]+'",';$("#constant_connected_users a[href^='"+jsFunctionStart+"']").css({color:"green","font-weight":"bold"})}}function select_user(e,t,n){$("#interlocutor_id").html(e);$("#interlocutor").html(t);$("#hide_extend_constant_chat_div, #constant_chat_div").css("display","block");update_chat(1);$("#constant_message_input").focus();if(aNotifications.length>1){if(jQuery.inArray(Number(e),aNotifications)>-1)gsn(-e)}else if(aNotifications.length==1){if(aNotifications[0]==Number(e))gsn(-e)}}function update_chat(e){if($("#constant_chat_div").css("display")=="none")return null;var t=$("#interlocutor_id").text();var n=$("#constant_message_div");if(t!=""){$.ajax({url:"http://www.buvetteetudiants.com/chat/update_chat.php",data:"interlocutor_id="+t,success:function(t){t=t.replace(/%([0-9]+)%/gi,"");n.html(t);if(e)myscroll()}})}}function uu(){$.ajax({url:"http://www.buvetteetudiants.com/chat/uu.php",data:"criterion=all",success:function(e){$("#constant_connected_users").html(e);nudge(aNotifications);if(clicked_link!="")$("#constant_connected_users a:contains("+clicked_link+")").css("text-decoration","underline")}})}function gsn(e){$.ajax({url:"http://www.buvetteetudiants.com/chat/gsn.php",data:"notified="+e,success:function(e){aNotifications=jQuery.parseJSON(e);nudge(aNotifications);if(clicked_link!="")$("#constant_connected_users a:contains("+clicked_link+")").css("text-decoration","underline")}})}function myscroll(){var e=$("#constant_message_div");e[0].scrollTop=e[0].scrollHeight}aNotifications=new Array;clicked_link="";firstTitle=$("title").text();myUpdateUsersInterval=window.setInterval("uu()",6e4);myUpdateChatInterval=window.setInterval("update_chat(0)",8e3);myGlobalSessionInterval=window.setInterval("g_se()",35e3);myNotificationsInterval=window.setInterval("gsn(0)",1e4);myScrollInterval=window.setInterval("myscroll()",2e3);myToggleTitleInterval=window.setInterval("toggleTitle(firstTitle)",2e3);myRefreshApplicationInterval=window.setInterval("r_ap()",8e4);$(document).ready(function(){$.ajaxSetup({global:true,type:"POST",dataType:"html"});g_se();uu();gsn(0);$("#constant_message_div").hover(function(){window.clearInterval(myScrollInterval)},function(){myScrollInterval=window.setInterval("myscroll()",2e3)});$("#constant_message_input").keypress(function(e){if(e.which==13){var t=$("#constant_message_input").val();var n=$("#interlocutor").text();var r=$("#interlocutor_id").text();if($.trim(t)==""){alert("Vous ne pouvez pas envoyer un message vide !");$("#constant_message_input").val("").focus()}else if(n=="Votre interlocuteur courant")alert("Vous devez sélectionner un utilisateur !");else{$("#constant_message_input").val("").focus();$.ajax({url:"http://www.buvetteetudiants.com/chat/send_msg.php",data:"message="+encodeURIComponent(t)+"&addressee_id="+r+"&addressee="+n,success:function(e){update_chat(1);gsn(r);$("#constant_connected_users a:contains("+clicked_link+")").css("text-decoration","underline");if(e=="disconnected"){alert("L'utilisateur ("+n+") s'est déconnecté !");uu()}}})}return false}});$("#hide_chat").click(function(){$("#hide_extend_constant_chat_div, #constant_chat_div").css("display","none")});$("#hide_connected_users").click(function(){clearInterval(myUpdateUsersInterval);$("#constant_connected_users").height(16).html('<div style="text-align: center;" id="display_connected_users"><a href="#">Afficher</a></div>');$(this).hide();$("#chat_access").hide()});$("#constant_connected_users").delegate("#display_connected_users","click",function(e){e.preventDefault();$("#constant_connected_users").height(300);$("#hide_connected_users").show();$("#chat_access").show();uu();myUpdateUsersInterval=window.setInterval("uu()",6e4)});$("#constant_connected_users").delegate("a","click",function(){clicked_link=$(this).text();$("#constant_connected_users a").each(function(e){if($(this).css("text-decoration")=="underline")$(this).css("text-decoration","none")});$(this).css("text-decoration","underline")})})